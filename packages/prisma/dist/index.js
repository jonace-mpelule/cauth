import{__commonJSMin as e,__require as t,__toESM as n}from"./chunk-BJUc-MpE.js";var r=e(((e,n)=>{var r=t(`fs`),i=t(`path`),a=t(`os`),o=typeof __webpack_require__==`function`?__non_webpack_require__:t,s=process.config&&process.config.variables||{},c=!!process.env.PREBUILDS_ONLY,l=process.versions.modules,u=O()?`electron`:D()?`node-webkit`:`node`,d=process.env.npm_config_arch||a.arch(),f=process.env.npm_config_platform||a.platform(),p=process.env.LIBC||(k(f)?`musl`:`glibc`),m=process.env.ARM_VERSION||(d===`arm64`?`8`:s.arm_version)||``,h=(process.versions.uv||``).split(`.`)[0];n.exports=g;function g(e){return o(g.resolve(e))}g.resolve=g.path=function(e){e=i.resolve(e||`.`);try{var t=o(i.join(e,`package.json`)).name.toUpperCase().replace(/-/g,`_`);process.env[t+`_PREBUILD`]&&(e=process.env[t+`_PREBUILD`])}catch{}if(!c){var n=v(i.join(e,`build/Release`),y);if(n)return n;var r=v(i.join(e,`build/Debug`),y);if(r)return r}var a=T(e);if(a)return a;var s=T(i.dirname(process.execPath));if(s)return s;var g=[`platform=`+f,`arch=`+d,`runtime=`+u,`abi=`+l,`uv=`+h,m?`armv=`+m:``,`libc=`+p,`node=`+process.versions.node,process.versions.electron?`electron=`+process.versions.electron:``,typeof __webpack_require__==`function`?`webpack=true`:``].filter(Boolean).join(` `);throw Error(`No native build was found for `+g+`
    loaded from: `+e+`
`);function T(e){var t=_(i.join(e,`prebuilds`)).map(b).filter(x(f,d)).sort(S)[0];if(t){var n=i.join(e,`prebuilds`,t.name),r=_(n).map(C).filter(w(u,l)).sort(E(u))[0];if(r)return i.join(n,r.file)}}};function _(e){try{return r.readdirSync(e)}catch{return[]}}function v(e,t){var n=_(e).filter(t);return n[0]&&i.join(e,n[0])}function y(e){return/\.node$/.test(e)}function b(e){var t=e.split(`-`);if(t.length===2){var n=t[0],r=t[1].split(`+`);if(n&&r.length&&r.every(Boolean))return{name:e,platform:n,architectures:r}}}function x(e,t){return function(n){return n==null||n.platform!==e?!1:n.architectures.includes(t)}}function S(e,t){return e.architectures.length-t.architectures.length}function C(e){var t=e.split(`.`),n=t.pop(),r={file:e,specificity:0};if(n===`node`){for(var i=0;i<t.length;i++){var a=t[i];if(a===`node`||a===`electron`||a===`node-webkit`)r.runtime=a;else if(a===`napi`)r.napi=!0;else if(a.slice(0,3)===`abi`)r.abi=a.slice(3);else if(a.slice(0,2)===`uv`)r.uv=a.slice(2);else if(a.slice(0,4)===`armv`)r.armv=a.slice(4);else if(a===`glibc`||a===`musl`)r.libc=a;else continue;r.specificity++}return r}}function w(e,t){return function(n){return!(n==null||n.runtime&&n.runtime!==e&&!T(n)||n.abi&&n.abi!==t&&!n.napi||n.uv&&n.uv!==h||n.armv&&n.armv!==m||n.libc&&n.libc!==p)}}function T(e){return e.runtime===`node`&&e.napi}function E(e){return function(t,n){return t.runtime===n.runtime?t.abi===n.abi?t.specificity===n.specificity?0:t.specificity>n.specificity?-1:1:t.abi?-1:1:t.runtime===e?-1:1}}function D(){return!!(process.versions&&process.versions.nw)}function O(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<`u`&&window.process&&window.process.type===`renderer`}function k(e){return e===`linux`&&r.existsSync(`/etc/alpine-release`)}g.parseTags=C,g.matchTags=w,g.compareTags=E,g.parseTuple=b,g.matchTuple=x,g.compareTuples=S})),i=e(((e,n)=>{let i=typeof __webpack_require__==`function`?__non_webpack_require__:t;typeof i.addon==`function`?n.exports=i.addon.bind(i):n.exports=r()})),a=e(((e,t)=>{let n=global.Promise;function r(e,t,r){return Array.isArray(r)||(r=Array.prototype.slice.call(r)),typeof e==`function`?new n((n,i)=>{r.push((e,t)=>{e?i(e):n(t)}),e.apply(t,r)}):n.reject(Error(`fn must be a function`))}function i(e){return n.reject(e)}function a(e){n=e}t.exports={promise:r,reject:i,use:a}})),o=n(e(((e,n)=>{let r=t(`path`),o=i()(r.resolve(__dirname)),s=t(`crypto`),c=a();function l(e,t){if(!e)e=10;else if(typeof e!=`number`)throw Error(`rounds must be a number`);if(!t)t=`b`;else if(t!==`b`&&t!==`a`)throw Error(`minor must be either "a" or "b"`);return o.gen_salt_sync(t,e,s.randomBytes(16))}function u(e,t,n){let r;if(typeof arguments[0]==`function`?(n=arguments[0],e=10,t=`b`):typeof arguments[1]==`function`&&(n=arguments[1],t=`b`),!n)return c.promise(u,this,[e,t]);if(!e)e=10;else if(typeof e!=`number`)return r=Error(`rounds must be a number`),process.nextTick(function(){n(r)});if(!t)t=`b`;else if(t!==`b`&&t!==`a`)return r=Error(`minor must be either "a" or "b"`),process.nextTick(function(){n(r)});s.randomBytes(16,function(r,i){if(r){n(r);return}o.gen_salt(t,e,i,n)})}function d(e,t){if(e==null||t==null)throw Error(`data and salt arguments required`);if(!(typeof e==`string`||e instanceof Buffer)||typeof t!=`string`&&typeof t!=`number`)throw Error(`data must be a string or Buffer and salt must either be a salt string or a number of rounds`);return typeof t==`number`&&(t=n.exports.genSaltSync(t)),o.encrypt_sync(e,t)}function f(e,t,r){let i;return typeof e==`function`?(i=Error(`data must be a string or Buffer and salt must either be a salt string or a number of rounds`),process.nextTick(function(){e(i)})):typeof t==`function`?(i=Error(`data must be a string or Buffer and salt must either be a salt string or a number of rounds`),process.nextTick(function(){t(i)})):r&&typeof r!=`function`?c.reject(Error(`cb must be a function or null to return a Promise`)):r?e==null||t==null?(i=Error(`data and salt arguments required`),process.nextTick(function(){r(i)})):!(typeof e==`string`||e instanceof Buffer)||typeof t!=`string`&&typeof t!=`number`?(i=Error(`data must be a string or Buffer and salt must either be a salt string or a number of rounds`),process.nextTick(function(){r(i)})):typeof t==`number`?n.exports.genSalt(t,function(t,n){return o.encrypt(e,n,r)}):o.encrypt(e,t,r):c.promise(f,this,[e,t])}function p(e,t){if(e==null||t==null)throw Error(`data and hash arguments required`);if(!(typeof e==`string`||e instanceof Buffer)||typeof t!=`string`)throw Error(`data must be a string or Buffer and hash must be a string`);return o.compare_sync(e,t)}function m(e,t,n){let r;return typeof e==`function`?(r=Error(`data and hash arguments required`),process.nextTick(function(){e(r)})):typeof t==`function`?(r=Error(`data and hash arguments required`),process.nextTick(function(){t(r)})):n&&typeof n!=`function`?c.reject(Error(`cb must be a function or null to return a Promise`)):n?e==null||t==null?(r=Error(`data and hash arguments required`),process.nextTick(function(){n(r)})):!(typeof e==`string`||e instanceof Buffer)||typeof t!=`string`?(r=Error(`data and hash must be strings`),process.nextTick(function(){n(r)})):o.compare(e,t,n):c.promise(m,this,[e,t])}function h(e){if(e==null)throw Error(`hash argument required`);if(typeof e!=`string`)throw Error(`hash must be a string`);return o.get_rounds(e)}n.exports={genSaltSync:l,genSalt:u,hashSync:d,hash:f,compareSync:p,compare:m,getRounds:h}}))(),1),s=class{#client;constructor(e){this.client=e,this.#client=e}async createOTP({config:e},{...t}){let n=Math.min(Math.max(e?.otpConfig?.length??6,4),8),r=Array.from({length:n},()=>Math.floor(Math.random()*10)).join(``),i=e?.otpConfig?.expiresIn??300*1e3,a=new Date(Date.now()+i),s=await o.default.hash(r,10);return await this.#client.otp.create({data:{id:t.id,code:s,isUsed:!1,purpose:t.purpose,expiresAt:a}})}async verifyOTP({...e}){let t=await this.#client.otp.findFirst({where:{id:e.id}});return!t||!await o.default.compare(e.code,t.code)||t.isUsed||t.expiresAt.getTime()<Date.now()||t.purpose!==e.purpose?{isValid:!1}:(await this.#client.otp.update({where:{id:t.id},data:{isUsed:!0}}),{isValid:!0})}async findAccountById({id:e}){return await this.#client.auth.findFirst({where:{id:e}})}async findAccountWithCredential({...e}){return await this.#client.auth.findFirst({where:{OR:[{email:e.email},{phoneNumber:e.phoneNumber}]},select:e.select})}async createAccount({...e}){return await this.#client.auth.create({data:e.data})}async removeAndAddRefreshToken({id:e,refreshToken:t,select:n,newRefreshToken:r}){let i=await this.findAccountById({id:e});if(!i)throw Error(`account-not-found: ${e}`);let a=i?.refreshTokens?.filter(e=>e!==t);return r&&(a?.push(r),a=Array.from(new Set(a))),this.#client.auth.update({where:{id:e},data:{refreshTokens:{set:a}},select:n})}async updateAccountLogin({...e}){return this.#client.auth.update({where:{id:e.id},data:{lastLogin:new Date,refreshTokens:{push:e.refreshToken}},select:e.select})}async updateAccount({...e}){return await this.#client.auth.update({where:{id:e.id},data:e.data})}async deleteAccount({id:e}){return await this.#client.auth.delete({where:{id:e}})}};export{s as PrismaProvider};